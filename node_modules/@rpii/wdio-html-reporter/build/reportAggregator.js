"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _htmlGenerator = _interopRequireDefault(require("./htmlGenerator"));

var _copyFiles = _interopRequireDefault(require("./copyFiles"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const open = require('open');

const fs = require('fs-extra');

const path = require('path');

const moment = require('moment');

const logger = require('@log4js-node/log4js-api');

function walk(dir, extensions, filelist = []) {
  const files = fs.readdirSync(dir);
  files.forEach(function (file) {
    const filepath = path.join(dir, file);
    const stat = fs.statSync(filepath);

    if (stat.isDirectory()) {
      filelist = walk(filepath, extensions, filelist);
    } else {
      extensions.forEach(function (extension) {
        if (file.indexOf(extension) == file.length - extension.length) {
          filelist.push(filepath);
        }
      });
    }
  });
  return filelist;
}

class ReportAggregator {
  constructor(opts) {
    opts = Object.assign({}, {
      outputDir: 'reports/html-reports/',
      filename: 'master-report.html',
      reportTitle: 'Test Master Report',
      showInBrowser: false,
      templateFilename: path.resolve(__dirname, '../templates/wdio-html-reporter-template.hbs'),
      templateFuncs: {},
      browserName: "not specified",
      collapseTests: false,
      LOG: null
    }, opts);
    this.options = opts;

    if (!this.options.LOG) {
      this.options.LOG = logger.getLogger("default");
    }

    this.options.reportFile = path.join(process.cwd(), this.options.outputDir, this.options.filename);
    this.reports = [];
  }

  clean() {
    fs.emptyDirSync(this.options.outputDir);
  }

  readJsonFiles() {
    return walk(this.options.outputDir, [".json"]);
  }

  log(message, object) {
    if (this.options.LOG) {
      this.options.LOG.debug(message + object);
    }
  }

  async createReport() {
    if (this.options.LOG) {
      this.options.LOG.debug("Report Aggregation started");
    }

    let metrics = {
      passed: 0,
      skipped: 0,
      failed: 0,
      start: new moment(),
      end: new moment(),
      duration: 0
    };
    let suites = [];
    let specs = [];
    let files = this.readJsonFiles();

    for (let i = 0; i < files.length; i++) {
      try {
        let filename = files[i];
        let report = JSON.parse(fs.readFileSync(filename));

        if (!report.info || !report.info.specs) {
          this.options.LOG.error("report structure in question, no info or info.specs ", JSON.stringify(report));
          this.options.LOG.info("report content: ", JSON.stringify(report));
        }

        report.info.specs.forEach(spec => {
          specs.push(spec);
        });
        this.reports.push(report);
        metrics.passed += report.metrics.passed;
        metrics.failed += report.metrics.failed;
        metrics.skipped += report.metrics.skipped;

        for (let k = 0; k < report.suites.length; k++) {
          let suite = report.suites[k];
          let start = moment.utc(suite.start);

          if (start.isSameOrBefore(metrics.start)) {
            metrics.start = start;
          }

          let end = moment.utc(suite.end);

          if (end.isAfter(metrics.end)) {
            metrics.end = end;
          }

          suites.push(suite);
        }
      } catch (ex) {
        console.error(ex);
      }
    }

    if (!this.reports || !this.reports.length) {
      // the test failed hard at the beginning.  Create a dummy structure to get through html generation
      let report = {
        "info": {
          "cid": "The execution of the test suite has failed before report generation was started.  Please look at the logs to determine the error, this is likely an issue with your configuration files.",
          "config": {
            "hostname": "localhost"
          },
          "specs": [],
          "suites": [{
            "uid": "Test Start Failure",
            "title": "Test Start Failure",
            "type": "suite",
            "tests": []
          }]
        }
      };
      this.reports = [];
      this.reports.push(report);
    }

    let duration = metrics.end.diff(metrics.start);
    metrics.duration = moment.duration(duration, "milliseconds").format('hh:mm:ss.SS', {
      trim: false
    });
    metrics.start = metrics.start.format();
    metrics.end = metrics.end.format();
    const reportOptions = {
      data: {
        info: this.reports[0].info,
        specs: specs,
        metrics: metrics,
        suites: suites,
        title: this.options.reportTitle,
        browserName: this.options.browserName
      },
      outputDir: this.options.outputDir,
      reportFile: this.options.reportFile,
      templateFilename: this.options.templateFilename,
      LOG: this.options.LOG,
      templateFuncs: this.options.templateFuncs,
      showInBrowser: this.options.showInBrowser,
      collapseTests: this.options.collapseTests
    };

    if (this.options.LOG) {
      this.options.LOG.debug("Aggregated " + specs.length + " specs, " + suites.length + " suites, " + this.reports.length + " reports, ");
    }

    _htmlGenerator.default.htmlOutput(reportOptions);

    reportOptions.LOG.debug("Report Aggregation completed");
    let jsFiles = path.join(__dirname, '../js/');
    let reportDir = path.join(process.cwd(), this.options.outputDir);

    try {
      const files = fs.readdirSync(jsFiles);
      await (0, _copyFiles.default)(jsFiles, reportDir, files);

      if (this.options.showInBrowser) {
        let childProcess = open(this.options.reportFile);
        childProcess.then(() => {
          reportOptions.LOG.info('browser launched');
        }, error => {
          reportOptions.LOG.error('showInBrowser error spawning :' + this.options.reportFile + " " + error.toString());
        });
      }
    } catch (ex) {
      reportOptions.LOG.error('Error opening browser:' + ex);
    }
  }

}

var _default = ReportAggregator;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBvcnRBZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm9wZW4iLCJyZXF1aXJlIiwiZnMiLCJwYXRoIiwibW9tZW50IiwibG9nZ2VyIiwid2FsayIsImRpciIsImV4dGVuc2lvbnMiLCJmaWxlbGlzdCIsImZpbGVzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZSIsImZpbGVwYXRoIiwiam9pbiIsInN0YXQiLCJzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiZXh0ZW5zaW9uIiwiaW5kZXhPZiIsImxlbmd0aCIsInB1c2giLCJSZXBvcnRBZ2dyZWdhdG9yIiwiY29uc3RydWN0b3IiLCJvcHRzIiwiT2JqZWN0IiwiYXNzaWduIiwib3V0cHV0RGlyIiwiZmlsZW5hbWUiLCJyZXBvcnRUaXRsZSIsInNob3dJbkJyb3dzZXIiLCJ0ZW1wbGF0ZUZpbGVuYW1lIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInRlbXBsYXRlRnVuY3MiLCJicm93c2VyTmFtZSIsImNvbGxhcHNlVGVzdHMiLCJMT0ciLCJvcHRpb25zIiwiZ2V0TG9nZ2VyIiwicmVwb3J0RmlsZSIsInByb2Nlc3MiLCJjd2QiLCJyZXBvcnRzIiwiY2xlYW4iLCJlbXB0eURpclN5bmMiLCJyZWFkSnNvbkZpbGVzIiwibG9nIiwibWVzc2FnZSIsIm9iamVjdCIsImRlYnVnIiwiY3JlYXRlUmVwb3J0IiwibWV0cmljcyIsInBhc3NlZCIsInNraXBwZWQiLCJmYWlsZWQiLCJzdGFydCIsImVuZCIsImR1cmF0aW9uIiwic3VpdGVzIiwic3BlY3MiLCJpIiwicmVwb3J0IiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwiaW5mbyIsImVycm9yIiwic3RyaW5naWZ5Iiwic3BlYyIsImsiLCJzdWl0ZSIsInV0YyIsImlzU2FtZU9yQmVmb3JlIiwiaXNBZnRlciIsImV4IiwiY29uc29sZSIsImRpZmYiLCJmb3JtYXQiLCJ0cmltIiwicmVwb3J0T3B0aW9ucyIsImRhdGEiLCJ0aXRsZSIsIkh0bWxHZW5lcmF0b3IiLCJodG1sT3V0cHV0IiwianNGaWxlcyIsInJlcG9ydERpciIsImNoaWxkUHJvY2VzcyIsInRoZW4iLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFDQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1DLEVBQUUsR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBbEI7O0FBQ0EsTUFBTUUsSUFBSSxHQUFHRixPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNRyxNQUFNLEdBQUdILE9BQU8sQ0FBQyxRQUFELENBQXRCOztBQUNBLE1BQU1JLE1BQU0sR0FBR0osT0FBTyxDQUFDLHlCQUFELENBQXRCOztBQUVBLFNBQVVLLElBQVYsQ0FBZUMsR0FBZixFQUFvQkMsVUFBcEIsRUFBaUNDLFFBQVEsR0FBRyxFQUE1QyxFQUFnRDtBQUM1QyxRQUFNQyxLQUFLLEdBQUdSLEVBQUUsQ0FBQ1MsV0FBSCxDQUFlSixHQUFmLENBQWQ7QUFFQUcsRUFBQUEsS0FBSyxDQUFDRSxPQUFOLENBQWMsVUFBVUMsSUFBVixFQUFnQjtBQUMxQixVQUFNQyxRQUFRLEdBQUdYLElBQUksQ0FBQ1ksSUFBTCxDQUFVUixHQUFWLEVBQWVNLElBQWYsQ0FBakI7QUFDQSxVQUFNRyxJQUFJLEdBQUdkLEVBQUUsQ0FBQ2UsUUFBSCxDQUFZSCxRQUFaLENBQWI7O0FBRUEsUUFBSUUsSUFBSSxDQUFDRSxXQUFMLEVBQUosRUFBd0I7QUFDcEJULE1BQUFBLFFBQVEsR0FBR0gsSUFBSSxDQUFDUSxRQUFELEVBQVdOLFVBQVgsRUFBdUJDLFFBQXZCLENBQWY7QUFDSCxLQUZELE1BRU87QUFDSEQsTUFBQUEsVUFBVSxDQUFDSSxPQUFYLENBQW1CLFVBQVVPLFNBQVYsRUFBcUI7QUFDcEMsWUFBSU4sSUFBSSxDQUFDTyxPQUFMLENBQWFELFNBQWIsS0FBMkJOLElBQUksQ0FBQ1EsTUFBTCxHQUFjRixTQUFTLENBQUNFLE1BQXZELEVBQStEO0FBQzNEWixVQUFBQSxRQUFRLENBQUNhLElBQVQsQ0FBY1IsUUFBZDtBQUNIO0FBQ0osT0FKRDtBQUtIO0FBQ0osR0FiRDtBQWVBLFNBQU9MLFFBQVA7QUFDSDs7QUFFRCxNQUFNYyxnQkFBTixDQUF1QjtBQUVuQkMsRUFBQUEsV0FBVyxDQUFDQyxJQUFELEVBQU87QUFDZEEsSUFBQUEsSUFBSSxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCO0FBQ3JCQyxNQUFBQSxTQUFTLEVBQUUsdUJBRFU7QUFFckJDLE1BQUFBLFFBQVEsRUFBRSxvQkFGVztBQUdyQkMsTUFBQUEsV0FBVyxFQUFFLG9CQUhRO0FBSXJCQyxNQUFBQSxhQUFhLEVBQUUsS0FKTTtBQUtyQkMsTUFBQUEsZ0JBQWdCLEVBQUU3QixJQUFJLENBQUM4QixPQUFMLENBQWFDLFNBQWIsRUFBd0IsOENBQXhCLENBTEc7QUFNckJDLE1BQUFBLGFBQWEsRUFBRSxFQU5NO0FBT3JCQyxNQUFBQSxXQUFXLEVBQUUsZUFQUTtBQVFyQkMsTUFBQUEsYUFBYSxFQUFFLEtBUk07QUFTckJDLE1BQUFBLEdBQUcsRUFBRTtBQVRnQixLQUFsQixFQVVKYixJQVZJLENBQVA7QUFXQSxTQUFLYyxPQUFMLEdBQWVkLElBQWY7O0FBQ0EsUUFBSSxDQUFDLEtBQUtjLE9BQUwsQ0FBYUQsR0FBbEIsRUFBdUI7QUFDbkIsV0FBS0MsT0FBTCxDQUFhRCxHQUFiLEdBQW1CakMsTUFBTSxDQUFDbUMsU0FBUCxDQUFpQixTQUFqQixDQUFuQjtBQUNIOztBQUNELFNBQUtELE9BQUwsQ0FBYUUsVUFBYixHQUEwQnRDLElBQUksQ0FBQ1ksSUFBTCxDQUFVMkIsT0FBTyxDQUFDQyxHQUFSLEVBQVYsRUFBeUIsS0FBS0osT0FBTCxDQUFhWCxTQUF0QyxFQUFpRCxLQUFLVyxPQUFMLENBQWFWLFFBQTlELENBQTFCO0FBQ0EsU0FBS2UsT0FBTCxHQUFlLEVBQWY7QUFDSDs7QUFFREMsRUFBQUEsS0FBSyxHQUFHO0FBQ0ozQyxJQUFBQSxFQUFFLENBQUM0QyxZQUFILENBQWdCLEtBQUtQLE9BQUwsQ0FBYVgsU0FBN0I7QUFDSDs7QUFJRG1CLEVBQUFBLGFBQWEsR0FBRztBQUNaLFdBQU96QyxJQUFJLENBQUMsS0FBS2lDLE9BQUwsQ0FBYVgsU0FBZCxFQUF5QixDQUFDLE9BQUQsQ0FBekIsQ0FBWDtBQUNIOztBQUdEb0IsRUFBQUEsR0FBRyxDQUFDQyxPQUFELEVBQVNDLE1BQVQsRUFBaUI7QUFDaEIsUUFBSSxLQUFLWCxPQUFMLENBQWFELEdBQWpCLEVBQXNCO0FBQ2xCLFdBQUtDLE9BQUwsQ0FBYUQsR0FBYixDQUFpQmEsS0FBakIsQ0FBdUJGLE9BQU8sR0FBR0MsTUFBakM7QUFDSDtBQUNKOztBQUNELFFBQU1FLFlBQU4sR0FBcUI7QUFDakIsUUFBSSxLQUFLYixPQUFMLENBQWFELEdBQWpCLEVBQXNCO0FBQ2xCLFdBQUtDLE9BQUwsQ0FBYUQsR0FBYixDQUFpQmEsS0FBakIsQ0FBdUIsNEJBQXZCO0FBQ0g7O0FBQ0QsUUFBSUUsT0FBTyxHQUFHO0FBQ1ZDLE1BQUFBLE1BQU0sRUFBRSxDQURFO0FBRVZDLE1BQUFBLE9BQU8sRUFBRSxDQUZDO0FBR1ZDLE1BQUFBLE1BQU0sRUFBRSxDQUhFO0FBSVZDLE1BQUFBLEtBQUssRUFBRyxJQUFJckQsTUFBSixFQUpFO0FBS1ZzRCxNQUFBQSxHQUFHLEVBQUcsSUFBSXRELE1BQUosRUFMSTtBQU1WdUQsTUFBQUEsUUFBUSxFQUFFO0FBTkEsS0FBZDtBQVFBLFFBQUlDLE1BQU0sR0FBRyxFQUFiO0FBQ0EsUUFBSUMsS0FBSyxHQUFHLEVBQVo7QUFFQSxRQUFJbkQsS0FBSyxHQUFHLEtBQUtxQyxhQUFMLEVBQVo7O0FBRUEsU0FBSyxJQUFJZSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHcEQsS0FBSyxDQUFDVyxNQUExQixFQUFrQ3lDLENBQUMsRUFBbkMsRUFBdUM7QUFDbkMsVUFBSTtBQUNBLFlBQUlqQyxRQUFRLEdBQUduQixLQUFLLENBQUNvRCxDQUFELENBQXBCO0FBQ0EsWUFBSUMsTUFBTSxHQUFHQyxJQUFJLENBQUNDLEtBQUwsQ0FBVy9ELEVBQUUsQ0FBQ2dFLFlBQUgsQ0FBZ0JyQyxRQUFoQixDQUFYLENBQWI7O0FBQ0EsWUFBSSxDQUFDa0MsTUFBTSxDQUFDSSxJQUFSLElBQWdCLENBQUNKLE1BQU0sQ0FBQ0ksSUFBUCxDQUFZTixLQUFqQyxFQUF3QztBQUNwQyxlQUFLdEIsT0FBTCxDQUFhRCxHQUFiLENBQWlCOEIsS0FBakIsQ0FBdUIsc0RBQXZCLEVBQWdGSixJQUFJLENBQUNLLFNBQUwsQ0FBZU4sTUFBZixDQUFoRjtBQUNBLGVBQUt4QixPQUFMLENBQWFELEdBQWIsQ0FBaUI2QixJQUFqQixDQUFzQixrQkFBdEIsRUFBMkNILElBQUksQ0FBQ0ssU0FBTCxDQUFlTixNQUFmLENBQTNDO0FBQ0g7O0FBQ0RBLFFBQUFBLE1BQU0sQ0FBQ0ksSUFBUCxDQUFZTixLQUFaLENBQWtCakQsT0FBbEIsQ0FBMkIwRCxJQUFELElBQVU7QUFDaENULFVBQUFBLEtBQUssQ0FBQ3ZDLElBQU4sQ0FBV2dELElBQVg7QUFDSCxTQUZEO0FBS0EsYUFBSzFCLE9BQUwsQ0FBYXRCLElBQWIsQ0FBa0J5QyxNQUFsQjtBQUNBVixRQUFBQSxPQUFPLENBQUNDLE1BQVIsSUFBa0JTLE1BQU0sQ0FBQ1YsT0FBUCxDQUFlQyxNQUFqQztBQUNBRCxRQUFBQSxPQUFPLENBQUNHLE1BQVIsSUFBa0JPLE1BQU0sQ0FBQ1YsT0FBUCxDQUFlRyxNQUFqQztBQUNBSCxRQUFBQSxPQUFPLENBQUNFLE9BQVIsSUFBbUJRLE1BQU0sQ0FBQ1YsT0FBUCxDQUFlRSxPQUFsQzs7QUFFQSxhQUFLLElBQUlnQixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHUixNQUFNLENBQUNILE1BQVAsQ0FBY3ZDLE1BQWxDLEVBQTBDa0QsQ0FBQyxFQUEzQyxFQUErQztBQUMzQyxjQUFJQyxLQUFLLEdBQUdULE1BQU0sQ0FBQ0gsTUFBUCxDQUFjVyxDQUFkLENBQVo7QUFDQSxjQUFJZCxLQUFLLEdBQUdyRCxNQUFNLENBQUNxRSxHQUFQLENBQVdELEtBQUssQ0FBQ2YsS0FBakIsQ0FBWjs7QUFDQSxjQUFLQSxLQUFLLENBQUNpQixjQUFOLENBQXFCckIsT0FBTyxDQUFDSSxLQUE3QixDQUFMLEVBQTBDO0FBQ3RDSixZQUFBQSxPQUFPLENBQUNJLEtBQVIsR0FBaUJBLEtBQWpCO0FBQ0g7O0FBQ0QsY0FBSUMsR0FBRyxHQUFHdEQsTUFBTSxDQUFDcUUsR0FBUCxDQUFXRCxLQUFLLENBQUNkLEdBQWpCLENBQVY7O0FBQ0EsY0FBS0EsR0FBRyxDQUFDaUIsT0FBSixDQUFZdEIsT0FBTyxDQUFDSyxHQUFwQixDQUFMLEVBQStCO0FBQzNCTCxZQUFBQSxPQUFPLENBQUNLLEdBQVIsR0FBZUEsR0FBZjtBQUNIOztBQUNERSxVQUFBQSxNQUFNLENBQUN0QyxJQUFQLENBQVlrRCxLQUFaO0FBQ0g7QUFDSixPQTdCRCxDQTZCRSxPQUFPSSxFQUFQLEVBQVc7QUFDVEMsUUFBQUEsT0FBTyxDQUFDVCxLQUFSLENBQWNRLEVBQWQ7QUFDSDtBQUVKOztBQUNELFFBQUksQ0FBQyxLQUFLaEMsT0FBTixJQUFpQixDQUFDLEtBQUtBLE9BQUwsQ0FBYXZCLE1BQW5DLEVBQTRDO0FBQ3hDO0FBQ0EsVUFBSTBDLE1BQU0sR0FBRztBQUNULGdCQUFTO0FBQ0wsaUJBQU8sMExBREY7QUFFTCxvQkFBVTtBQUNOLHdCQUFZO0FBRE4sV0FGTDtBQUtULG1CQUFTLEVBTEE7QUFNVCxvQkFBVSxDQUNOO0FBQ0ksbUJBQU8sb0JBRFg7QUFFSSxxQkFBUyxvQkFGYjtBQUdJLG9CQUFRLE9BSFo7QUFJSSxxQkFBUztBQUpiLFdBRE07QUFORDtBQURBLE9BQWI7QUFpQkEsV0FBS25CLE9BQUwsR0FBZSxFQUFmO0FBQ0EsV0FBS0EsT0FBTCxDQUFhdEIsSUFBYixDQUFrQnlDLE1BQWxCO0FBQ0g7O0FBRUQsUUFBSUosUUFBUSxHQUFHTixPQUFPLENBQUNLLEdBQVIsQ0FBWW9CLElBQVosQ0FBaUJ6QixPQUFPLENBQUNJLEtBQXpCLENBQWY7QUFDQUosSUFBQUEsT0FBTyxDQUFDTSxRQUFSLEdBQW1CdkQsTUFBTSxDQUFDdUQsUUFBUCxDQUFnQkEsUUFBaEIsRUFBMEIsY0FBMUIsRUFBMENvQixNQUExQyxDQUFpRCxhQUFqRCxFQUFnRTtBQUFDQyxNQUFBQSxJQUFJLEVBQUU7QUFBUCxLQUFoRSxDQUFuQjtBQUNBM0IsSUFBQUEsT0FBTyxDQUFDSSxLQUFSLEdBQWdCSixPQUFPLENBQUNJLEtBQVIsQ0FBY3NCLE1BQWQsRUFBaEI7QUFDQTFCLElBQUFBLE9BQU8sQ0FBQ0ssR0FBUixHQUFjTCxPQUFPLENBQUNLLEdBQVIsQ0FBWXFCLE1BQVosRUFBZDtBQUVBLFVBQU1FLGFBQWEsR0FBRztBQUNsQkMsTUFBQUEsSUFBSSxFQUFFO0FBQ0ZmLFFBQUFBLElBQUksRUFBRSxLQUFLdkIsT0FBTCxDQUFhLENBQWIsRUFBZ0J1QixJQURwQjtBQUVGTixRQUFBQSxLQUFLLEVBQUNBLEtBRko7QUFHRlIsUUFBQUEsT0FBTyxFQUFFQSxPQUhQO0FBSUZPLFFBQUFBLE1BQU0sRUFBRUEsTUFKTjtBQUtGdUIsUUFBQUEsS0FBSyxFQUFFLEtBQUs1QyxPQUFMLENBQWFULFdBTGxCO0FBTUZNLFFBQUFBLFdBQVcsRUFBRSxLQUFLRyxPQUFMLENBQWFIO0FBTnhCLE9BRFk7QUFTbEJSLE1BQUFBLFNBQVMsRUFBRSxLQUFLVyxPQUFMLENBQWFYLFNBVE47QUFVbEJhLE1BQUFBLFVBQVUsRUFBRSxLQUFLRixPQUFMLENBQWFFLFVBVlA7QUFXbEJULE1BQUFBLGdCQUFnQixFQUFFLEtBQUtPLE9BQUwsQ0FBYVAsZ0JBWGI7QUFZbEJNLE1BQUFBLEdBQUcsRUFBRyxLQUFLQyxPQUFMLENBQWFELEdBWkQ7QUFhbEJILE1BQUFBLGFBQWEsRUFBRSxLQUFLSSxPQUFMLENBQWFKLGFBYlY7QUFjbEJKLE1BQUFBLGFBQWEsRUFBRSxLQUFLUSxPQUFMLENBQWFSLGFBZFY7QUFlbEJNLE1BQUFBLGFBQWEsRUFBRSxLQUFLRSxPQUFMLENBQWFGO0FBZlYsS0FBdEI7O0FBa0JBLFFBQUksS0FBS0UsT0FBTCxDQUFhRCxHQUFqQixFQUFzQjtBQUNsQixXQUFLQyxPQUFMLENBQWFELEdBQWIsQ0FBaUJhLEtBQWpCLENBQXVCLGdCQUFnQlUsS0FBSyxDQUFDeEMsTUFBdEIsR0FBK0IsVUFBL0IsR0FBNEN1QyxNQUFNLENBQUN2QyxNQUFuRCxHQUE0RCxXQUE1RCxHQUEwRSxLQUFLdUIsT0FBTCxDQUFhdkIsTUFBdkYsR0FBZ0csWUFBdkg7QUFDSDs7QUFDRCtELDJCQUFjQyxVQUFkLENBQXlCSixhQUF6Qjs7QUFDQUEsSUFBQUEsYUFBYSxDQUFDM0MsR0FBZCxDQUFrQmEsS0FBbEIsQ0FBd0IsOEJBQXhCO0FBQ0EsUUFBSW1DLE9BQU8sR0FBR25GLElBQUksQ0FBQ1ksSUFBTCxDQUFVbUIsU0FBVixFQUFxQixRQUFyQixDQUFkO0FBQ0EsUUFBSXFELFNBQVMsR0FBR3BGLElBQUksQ0FBQ1ksSUFBTCxDQUFVMkIsT0FBTyxDQUFDQyxHQUFSLEVBQVYsRUFBeUIsS0FBS0osT0FBTCxDQUFhWCxTQUF0QyxDQUFoQjs7QUFDQSxRQUFJO0FBQ0EsWUFBTWxCLEtBQUssR0FBR1IsRUFBRSxDQUFDUyxXQUFILENBQWUyRSxPQUFmLENBQWQ7QUFDQSxZQUFNLHdCQUFVQSxPQUFWLEVBQW1CQyxTQUFuQixFQUE4QjdFLEtBQTlCLENBQU47O0FBRUEsVUFBSSxLQUFLNkIsT0FBTCxDQUFhUixhQUFqQixFQUFnQztBQUU1QixZQUFJeUQsWUFBWSxHQUFHeEYsSUFBSSxDQUFDLEtBQUt1QyxPQUFMLENBQWFFLFVBQWQsQ0FBdkI7QUFDQStDLFFBQUFBLFlBQVksQ0FBQ0MsSUFBYixDQUNJLE1BQU07QUFDRlIsVUFBQUEsYUFBYSxDQUFDM0MsR0FBZCxDQUFrQjZCLElBQWxCLENBQXVCLGtCQUF2QjtBQUNILFNBSEwsRUFJS0MsS0FBRCxJQUFXO0FBQ1BhLFVBQUFBLGFBQWEsQ0FBQzNDLEdBQWQsQ0FBa0I4QixLQUFsQixDQUF3QixtQ0FBbUMsS0FBSzdCLE9BQUwsQ0FBYUUsVUFBaEQsR0FBNkQsR0FBN0QsR0FBbUUyQixLQUFLLENBQUNzQixRQUFOLEVBQTNGO0FBQ0gsU0FOTDtBQU9IO0FBQ0osS0FmRCxDQWVFLE9BQU9kLEVBQVAsRUFBVztBQUNUSyxNQUFBQSxhQUFhLENBQUMzQyxHQUFkLENBQWtCOEIsS0FBbEIsQ0FBd0IsMkJBQTJCUSxFQUFuRDtBQUNIO0FBRUo7O0FBbEtrQjs7ZUF1S1JyRCxnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIdG1sR2VuZXJhdG9yIGZyb20gXCIuL2h0bWxHZW5lcmF0b3JcIjtcclxuaW1wb3J0IGNvcHlGaWxlcyBmcm9tIFwiLi9jb3B5RmlsZXNcIiA7XHJcbmNvbnN0IG9wZW4gPSByZXF1aXJlKCdvcGVuJyk7XHJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMtZXh0cmEnKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJ0Bsb2c0anMtbm9kZS9sb2c0anMtYXBpJyk7XHJcblxyXG5mdW5jdGlvbiAgd2FsayhkaXIsIGV4dGVuc2lvbnMgLCBmaWxlbGlzdCA9IFtdKSB7XHJcbiAgICBjb25zdCBmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKGRpcik7XHJcblxyXG4gICAgZmlsZXMuZm9yRWFjaChmdW5jdGlvbiAoZmlsZSkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVwYXRoID0gcGF0aC5qb2luKGRpciwgZmlsZSk7XHJcbiAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKGZpbGVwYXRoKTtcclxuXHJcbiAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xyXG4gICAgICAgICAgICBmaWxlbGlzdCA9IHdhbGsoZmlsZXBhdGgsIGV4dGVuc2lvbnMsIGZpbGVsaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBleHRlbnNpb25zLmZvckVhY2goZnVuY3Rpb24gKGV4dGVuc2lvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpbGUuaW5kZXhPZihleHRlbnNpb24pID09IGZpbGUubGVuZ3RoIC0gZXh0ZW5zaW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVsaXN0LnB1c2goZmlsZXBhdGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZmlsZWxpc3Q7XHJcbn1cclxuXHJcbmNsYXNzIFJlcG9ydEFnZ3JlZ2F0b3Ige1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdHMpIHtcclxuICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwge1xyXG4gICAgICAgICAgICBvdXRwdXREaXI6ICdyZXBvcnRzL2h0bWwtcmVwb3J0cy8nLFxyXG4gICAgICAgICAgICBmaWxlbmFtZTogJ21hc3Rlci1yZXBvcnQuaHRtbCcsXHJcbiAgICAgICAgICAgIHJlcG9ydFRpdGxlOiAnVGVzdCBNYXN0ZXIgUmVwb3J0JyxcclxuICAgICAgICAgICAgc2hvd0luQnJvd3NlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZW5hbWU6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi90ZW1wbGF0ZXMvd2Rpby1odG1sLXJlcG9ydGVyLXRlbXBsYXRlLmhicycpLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZ1bmNzOiB7fSxcclxuICAgICAgICAgICAgYnJvd3Nlck5hbWU6IFwibm90IHNwZWNpZmllZFwiLFxyXG4gICAgICAgICAgICBjb2xsYXBzZVRlc3RzOiBmYWxzZSxcclxuICAgICAgICAgICAgTE9HOiBudWxsXHJcbiAgICAgICAgfSwgb3B0cyk7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0cztcclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRyA9IGxvZ2dlci5nZXRMb2dnZXIoXCJkZWZhdWx0XCIpICAgICAgO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLm9wdGlvbnMub3V0cHV0RGlyLCB0aGlzLm9wdGlvbnMuZmlsZW5hbWUpO1xyXG4gICAgICAgIHRoaXMucmVwb3J0cyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFuKCkge1xyXG4gICAgICAgIGZzLmVtcHR5RGlyU3luYyh0aGlzLm9wdGlvbnMub3V0cHV0RGlyKTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHJlYWRKc29uRmlsZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHdhbGsodGhpcy5vcHRpb25zLm91dHB1dERpciwgW1wiLmpzb25cIl0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBsb2cobWVzc2FnZSxvYmplY3QpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmRlYnVnKG1lc3NhZ2UgKyBvYmplY3QpIDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBjcmVhdGVSZXBvcnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5kZWJ1ZyhcIlJlcG9ydCBBZ2dyZWdhdGlvbiBzdGFydGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbWV0cmljcyA9IHtcclxuICAgICAgICAgICAgcGFzc2VkOiAwLFxyXG4gICAgICAgICAgICBza2lwcGVkOiAwLFxyXG4gICAgICAgICAgICBmYWlsZWQ6IDAsXHJcbiAgICAgICAgICAgIHN0YXJ0IDogbmV3IG1vbWVudCgpLFxyXG4gICAgICAgICAgICBlbmQgOiBuZXcgbW9tZW50KCksXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgc3VpdGVzID0gW107XHJcbiAgICAgICAgbGV0IHNwZWNzID0gW107XHJcblxyXG4gICAgICAgIGxldCBmaWxlcyA9IHRoaXMucmVhZEpzb25GaWxlcygpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsZW5hbWUgPSBmaWxlc1tpXTtcclxuICAgICAgICAgICAgICAgIGxldCByZXBvcnQgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhmaWxlbmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXBvcnQuaW5mbyB8fCAhcmVwb3J0LmluZm8uc3BlY3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmVycm9yKFwicmVwb3J0IHN0cnVjdHVyZSBpbiBxdWVzdGlvbiwgbm8gaW5mbyBvciBpbmZvLnNwZWNzIFwiICwgSlNPTi5zdHJpbmdpZnkocmVwb3J0KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5pbmZvKFwicmVwb3J0IGNvbnRlbnQ6IFwiICwgSlNPTi5zdHJpbmdpZnkocmVwb3J0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXBvcnQuaW5mby5zcGVjcy5mb3JFYWNoKChzcGVjKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BlY3MucHVzaChzcGVjKSA7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvcnRzLnB1c2gocmVwb3J0KTtcclxuICAgICAgICAgICAgICAgIG1ldHJpY3MucGFzc2VkICs9IHJlcG9ydC5tZXRyaWNzLnBhc3NlZDtcclxuICAgICAgICAgICAgICAgIG1ldHJpY3MuZmFpbGVkICs9IHJlcG9ydC5tZXRyaWNzLmZhaWxlZDtcclxuICAgICAgICAgICAgICAgIG1ldHJpY3Muc2tpcHBlZCArPSByZXBvcnQubWV0cmljcy5za2lwcGVkO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgcmVwb3J0LnN1aXRlcy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdWl0ZSA9IHJlcG9ydC5zdWl0ZXNba10gO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFydCA9IG1vbWVudC51dGMoc3VpdGUuc3RhcnQpIDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXJ0LmlzU2FtZU9yQmVmb3JlKG1ldHJpY3Muc3RhcnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY3Muc3RhcnQgPSAgc3RhcnQgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsZXQgZW5kID0gbW9tZW50LnV0YyhzdWl0ZS5lbmQpIDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGVuZC5pc0FmdGVyKG1ldHJpY3MuZW5kKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLmVuZCA9ICBlbmQgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzdWl0ZXMucHVzaChzdWl0ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV4KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlcG9ydHMgfHwgIXRoaXMucmVwb3J0cy5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSB0ZXN0IGZhaWxlZCBoYXJkIGF0IHRoZSBiZWdpbm5pbmcuICBDcmVhdGUgYSBkdW1teSBzdHJ1Y3R1cmUgdG8gZ2V0IHRocm91Z2ggaHRtbCBnZW5lcmF0aW9uXHJcbiAgICAgICAgICAgIGxldCByZXBvcnQgPSB7XHJcbiAgICAgICAgICAgICAgICBcImluZm9cIiA6IHtcclxuICAgICAgICAgICAgICAgICAgICBcImNpZFwiOiBcIlRoZSBleGVjdXRpb24gb2YgdGhlIHRlc3Qgc3VpdGUgaGFzIGZhaWxlZCBiZWZvcmUgcmVwb3J0IGdlbmVyYXRpb24gd2FzIHN0YXJ0ZWQuICBQbGVhc2UgbG9vayBhdCB0aGUgbG9ncyB0byBkZXRlcm1pbmUgdGhlIGVycm9yLCB0aGlzIGlzIGxpa2VseSBhbiBpc3N1ZSB3aXRoIHlvdXIgY29uZmlndXJhdGlvbiBmaWxlcy5cIixcclxuICAgICAgICAgICAgICAgICAgICBcImNvbmZpZ1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaG9zdG5hbWVcIjogXCJsb2NhbGhvc3RcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcInNwZWNzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgXCJzdWl0ZXNcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1aWRcIjogXCJUZXN0IFN0YXJ0IEZhaWx1cmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlRlc3QgU3RhcnQgRmFpbHVyZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJzdWl0ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRlc3RzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3J0cyA9IFtdIDtcclxuICAgICAgICAgICAgdGhpcy5yZXBvcnRzLnB1c2gocmVwb3J0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBkdXJhdGlvbiA9IG1ldHJpY3MuZW5kLmRpZmYobWV0cmljcy5zdGFydCkgO1xyXG4gICAgICAgIG1ldHJpY3MuZHVyYXRpb24gPSBtb21lbnQuZHVyYXRpb24oZHVyYXRpb24sIFwibWlsbGlzZWNvbmRzXCIpLmZvcm1hdCgnaGg6bW06c3MuU1MnLCB7dHJpbTogZmFsc2V9KTtcclxuICAgICAgICBtZXRyaWNzLnN0YXJ0ID0gbWV0cmljcy5zdGFydC5mb3JtYXQoKSA7XHJcbiAgICAgICAgbWV0cmljcy5lbmQgPSBtZXRyaWNzLmVuZC5mb3JtYXQoKSA7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlcG9ydE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIGluZm86IHRoaXMucmVwb3J0c1swXS5pbmZvLFxyXG4gICAgICAgICAgICAgICAgc3BlY3M6c3BlY3MsXHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzOiBtZXRyaWNzLFxyXG4gICAgICAgICAgICAgICAgc3VpdGVzOiBzdWl0ZXMsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5vcHRpb25zLnJlcG9ydFRpdGxlLFxyXG4gICAgICAgICAgICAgICAgYnJvd3Nlck5hbWU6IHRoaXMub3B0aW9ucy5icm93c2VyTmFtZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvdXRwdXREaXI6IHRoaXMub3B0aW9ucy5vdXRwdXREaXIsXHJcbiAgICAgICAgICAgIHJlcG9ydEZpbGU6IHRoaXMub3B0aW9ucy5yZXBvcnRGaWxlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGVuYW1lOiB0aGlzLm9wdGlvbnMudGVtcGxhdGVGaWxlbmFtZSxcclxuICAgICAgICAgICAgTE9HIDogdGhpcy5vcHRpb25zLkxPRyxcclxuICAgICAgICAgICAgdGVtcGxhdGVGdW5jczogdGhpcy5vcHRpb25zLnRlbXBsYXRlRnVuY3MsXHJcbiAgICAgICAgICAgIHNob3dJbkJyb3dzZXI6IHRoaXMub3B0aW9ucy5zaG93SW5Ccm93c2VyLFxyXG4gICAgICAgICAgICBjb2xsYXBzZVRlc3RzOiB0aGlzLm9wdGlvbnMuY29sbGFwc2VUZXN0c1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuTE9HKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZGVidWcoXCJBZ2dyZWdhdGVkIFwiICsgc3BlY3MubGVuZ3RoICsgXCIgc3BlY3MsIFwiICsgc3VpdGVzLmxlbmd0aCArIFwiIHN1aXRlcywgXCIgKyB0aGlzLnJlcG9ydHMubGVuZ3RoICsgXCIgcmVwb3J0cywgXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBIdG1sR2VuZXJhdG9yLmh0bWxPdXRwdXQocmVwb3J0T3B0aW9ucyk7XHJcbiAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZGVidWcoXCJSZXBvcnQgQWdncmVnYXRpb24gY29tcGxldGVkXCIpO1xyXG4gICAgICAgIGxldCBqc0ZpbGVzID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2pzLycpO1xyXG4gICAgICAgIGxldCByZXBvcnREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy5vcHRpb25zLm91dHB1dERpcik7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhqc0ZpbGVzKTtcclxuICAgICAgICAgICAgYXdhaXQgY29weUZpbGVzKGpzRmlsZXMsIHJlcG9ydERpciwgZmlsZXMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG93SW5Ccm93c2VyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGNoaWxkUHJvY2VzcyA9IG9wZW4odGhpcy5vcHRpb25zLnJlcG9ydEZpbGUpO1xyXG4gICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5pbmZvKCdicm93c2VyIGxhdW5jaGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZXJyb3IoJ3Nob3dJbkJyb3dzZXIgZXJyb3Igc3Bhd25pbmcgOicgKyB0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSArIFwiIFwiICsgZXJyb3IudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgIHJlcG9ydE9wdGlvbnMuTE9HLmVycm9yKCdFcnJvciBvcGVuaW5nIGJyb3dzZXI6JyArIGV4KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlcG9ydEFnZ3JlZ2F0b3I7XHJcbiJdfQ==